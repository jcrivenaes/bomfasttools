<!DOCTYPE html>
<html>

<script language="JavaScript">
    // < !--

    const MAXTRIES = 1000;
    const MAXYEARS = 200;
    const MRD = 1000000000.0;
    const MLL = 1000000.0

    let input_byggeoppstart = 2020;
    let input_byggetid = 7;
    let input_styringsramme = 10;
    let input_kostnadsramme = 12;
    let input_basisaar = 2018;
    let input_bompengelaan = 4;
    let input_laaneprofil = 0;  // velger mot noen definerte låneprofiler
    let input_forhaandsinnkrevet = 0;
    let input_nedbetalingstid = 15;
    let input_laanerente1 = 5.5;
    let input_laanerente2 = 6.5;
    let input_laanerente_endring = 10;
    let input_prisstigning = 2;
    let input_aadt_oppstart = 2030;
    let input_bomselskap = 15;
    let input_tungandel = 15;
    let input_tungmult = 3;
    let input_elbil_andel = 0;
    let input_elbil_rabattpris = 0;  // som % av fossilbil
    let input_offisielt = "vedtak";
    let input_aarlig_laan = [];

    // resultater som globale
    let result_kumulativt_laan = 0.0;
    let result_initiell_avg_bomsats = 0.0;
    let result_bomsatser = [];
    let result_bominntekt = [];
    let result_restlaan = [];
    let result_tilbomselskap = [];
    let result_tilbomselskap_sum = 0.0;
    let result_rentefot = [];
    let result_aadt = [];


    // de neste er her for låneopptak i byggeperioden
    let bygge_aar = [];
    let bygge_laanopptak = [];
    let bygge_kumulativt_laan = [];
    let bygge_kumulativt_laan_proj = [];
    let bygge_rentefot = [];

    function iterate_toll_value() {

        input_byggeoppstart = parseInt(document.calc.byggeoppstart.value);
        input_byggetid = parseInt(document.calc.byggetid.value);
        input_styringsramme = parseFloat(document.calc.styringsramme.value.replace(",", ".")) * MRD;
        input_kostnadsramme = parseFloat(document.calc.kostnadsramme.value.replace(",", ".")) * MRD;
        input_basisaar = parseInt(document.calc.basisaar.value);
        input_bompengelaan = parseFloat(document.calc.bompengelaan.value.replace(",", ".")) * MRD;
        input_laaneprofil = parseInt(document.calc.laaneprofil.value);
        input_forhaandsinnkrevet = parseFloat(document.calc.forhaandsinnkrevet.value.replace(",", ".")) * MRD;
        input_nedbetalingstid = parseInt(document.calc.nedbetalingstid.value);
        input_laanerente1 = parseFloat(document.calc.laanerente1.value.replace(",", ".")) / 100.0;
        input_laanerente2 = parseFloat(document.calc.laanerente2.value.replace(",", ".")) / 100.0;
        input_laanerente_endring = parseInt(document.calc.laanerente_endring.value);
        input_prisstigning = parseFloat(document.calc.prisstigning.value.replace(",", ".")) / 100.0;
        input_aadt_oppstart = parseInt(document.calc.aadt_oppstart.value);
        input_trafikkvekst = parseFloat(document.calc.trafikkvekst.value.replace(",", ".")) / 100.0;
        input_bomselskap = parseFloat(document.calc.bomselskap.value.replace(",", ".")) * MLL;
        input_tungandel = parseFloat(document.calc.tungandel.value.replace(",", ".")) / 100.0;
        input_tungmult = parseFloat(document.calc.tungmult.value.replace(",", "."));
        input_offisielt = document.calc.offisielt.value;

        if (input_laaneprofil == 4) {
            get_aarlig_profile(input_byggetid);
            console.log("Låneprofil", input_aarlig_laan);
        }


        console.log("Byggetid:", input_byggetid);
        console.log("Lån:", input_bompengelaan);
        console.log("Låneprofil:", input_laaneprofil);

        let cumloan = 0.0;
        if (input_laaneprofil == 0) {
            input_prisstigning = 0.0;  // as test!
            cumloan = compute_sumloan0();
        } else if (input_laaneprofil == 1) {
            cumloan = compute_sumloan1();
        } else if (input_laaneprofil == 2) {
            cumloan = compute_sumloan2();
        } else if (input_laaneprofil == 3) {
            cumloan = compute_sumloan3();
        } else if (input_laaneprofil == 4) {
            cumloan = compute_sumloan1();  // yes, 1
        }

        console.log("Kumulativt bompengelån:", cumloan);
        result_kumulativt_laan = cumloan

        // rough estimate of toll as start value...
        let toll = ((1.0 + input_laanerente1) * result_kumulativt_laan +
            input_bomselskap * input_nedbetalingstid) /
            (input_nedbetalingstid * 365 * input_aadt_oppstart);

        console.log("Initiell bompengesats:", toll);
        let finalyear = yearly_streams(toll);

        console.log("Initial finalyear:", finalyear);
        if (finalyear != -1 && finalyear <= input_nedbetalingstid) {
            toll = toll / 2.0
        }
        console.log("Initiell bompengesats (2):", toll);

        let tollincrement = 1;
        if (toll > 100) tollincrement = 5;
        if (toll > 300) tollincrement = 10;

        let previoustoll = toll;

        for (var i = 0; i < MAXTRIES; i++) {
            finalyear = yearly_streams(toll);

            console.log("Final year vs target:", finalyear, input_nedbetalingstid);

            if (finalyear == 1 || finalyear > input_nedbetalingstid) {
                previoustoll = toll;
                toll = toll + tollincrement;
            }
            else if (finalyear == -1) {
                previoustoll = toll;
                toll = toll + tollincrement;
            }
            else if (finalyear < input_nedbetalingstid) {
                toll = toll - tollincrement / 2.0;
            }
            else {
                break;
            }

        }
        previoustoll = toll * 0.95;
        console.log("ROUGH TOLL VALUE IS", toll);
        console.log("ITERATE USING", previoustoll);

        // fine tune to 50 or 10 øre
        tollincrement = 0.5
        if (toll < 50) {
            tollincrement = 0.1
        }
        toll = previoustoll;
        for (let i = 0; i < MAXTRIES; i++) {
            // console.log("Fine tune, toll = ", toll)
            finalyear = yearly_streams(toll);
            console.log(finalyear)

            if (finalyear == 1 || finalyear > input_nedbetalingstid) {
                toll = toll + tollincrement;
            }
            else if (finalyear == -1) {
                toll = toll + tollincrement
            }
            else if (finalyear < input_nedbetalingstid) {
                toll = toll - tollincrement
            }
            else {
                break;
            }
        }

        // run once more with mode=1 to make tables
        finalyear = yearly_streams(toll, mode = 1);

        console.log("Proposed toll is ", toll);
        result_initiell_avg_bomsats = toll;

    }

    function get_aarlig_profile(yrs) {

        if (document.bomaarlig.aar1.value != null) {
            input_aarlig_laan[0] = parseFloat(document.bomaarlig.aar1.value) * MRD;
        }
        if (document.bomaarlig.aar2.value != null) {
            input_aarlig_laan[1] = parseFloat(document.bomaarlig.aar2.value) * MRD;
        }
        if (document.bomaarlig.aar3.value != null) {
            input_aarlig_laan[2] = parseFloat(document.bomaarlig.aar3.value) * MRD;
        }
        if (document.bomaarlig.aar4.value != null) {
            input_aarlig_laan[3] = parseFloat(document.bomaarlig.aar4.value) * MRD;
        }
        if (document.bomaarlig.aar5.value != null) {
            input_aarlig_laan[4] = parseFloat(document.bomaarlig.aar5.value) * MRD;
        }
        if (document.bomaarlig.aar6.value != null) {
            input_aarlig_laan[5] = parseFloat(document.bomaarlig.aar6.value) * MRD;
        }
        if (document.bomaarlig.aar7.value != null) {
            input_aarlig_laan[6] = parseFloat(document.bomaarlig.aar7.value) * MRD;
        }
        if (document.bomaarlig.aar8.value != null) {
            input_aarlig_laan[7] = parseFloat(document.bomaarlig.aar8.value) * MRD;
        }
        if (document.bomaarlig.aar9.value != null) {
            input_aarlig_laan[8] = parseFloat(document.bomaarlig.aar9.value) * MRD;
        }
        if (document.bomaarlig.aar10.value != null) {
            input_aarlig_laan[9] = parseFloat(document.bomaarlig.aar10.value) * MRD;
        }

        console.log(input_aarlig_laan)
    }

    function compute_sumloan0() {
        // låneprofil 0: lån tas opp i like rater per år. Dette er Minkens formel
        // For eks 10 MRD ved 5.5% rente over byggetid 5 år:
        // result = (10 / 5) * (1.055^4 + 1.055^3 + ... + 1.055^0) = 11.1622 MRD
        // Ingen prisstigning her. For referanse!

        let cum = 0.0;

        let rente = input_laanerente1;
        for (let year = 0; year < input_byggetid; year++) {
            if (year >= input_laanerente_endring) {
                rente = input_laanerente2;
            }
            cum = cum + Math.pow(1.0 + rente, year);
        }
        let result = cum * input_bompengelaan / input_byggetid;

        return (result);
    }

    function compute_sumloan1() {
        // låneprofil 1: lån tas opp i like rater per år eller som vektor!.
        // Prisstigning er med her!

        let cum = 0.0;
        let cum_projected = 0.0;

        let rente = input_laanerente1;
        let aarlig_sum = input_bompengelaan / input_byggetid;
        let dyear = input_byggeoppstart - input_basisaar;
        for (let year = 0; year < input_byggetid; year++) {
            if (year >= input_laanerente_endring) {
                rente = input_laanerente2;
            }

            if (input_laaneprofil == 4) {
                aarlig_sum = input_aarlig_laan[year];
            }

            let reell_sum = aarlig_sum * Math.pow((1 + input_prisstigning), year + dyear);

            console.log("Låneopptak (mill) i år", year + input_byggeoppstart, "er", (reell_sum / MLL).toFixed(4))
            cum = (cum + reell_sum) * (1.0 + rente);

            let part = reell_sum * Math.pow((1.0 + rente), input_byggetid - year);
            cum_projected += part;

            bygge_aar[year] = input_byggeoppstart + year;
            bygge_laanopptak[year] = reell_sum;
            bygge_kumulativt_laan[year] = cum;
            bygge_kumulativt_laan_proj[year] = part;  // vil bli feil dersom rente endres!
            bygge_rentefot[year] = rente;
        }

        return (cum);
    }


    function compute_sumloan2() {
        // Her er bomselskap tidlig og forholdet mellom stat og bomselskap må beregnes
        // Etter bomselskap er ferdig å låne så går det noe tid mens stat låner, så
        // det blir rentes renter... Pessimistisk scenario

        let cum = 0.0;
        let cum_projected = 0.0;

        let rente = input_laanerente1;

        let aarlig_total_sum = input_styringsramme / input_byggetid;
        let dyear = input_byggeoppstart - input_basisaar;
        let laane_andel = input_bompengelaan;

        for (let year = 0; year < input_byggetid; year++) {
            if (year >= input_laanerente_endring) {
                rente = input_laanerente2;
            }

            let aarlig_sum = 0.0;
            if (aarlig_total_sum < laane_andel) {
                aarlig_sum = aarlig_total_sum;
                laane_andel = laane_andel - aarlig_sum;
            }
            else if (aarlig_total_sum > laane_andel && laane_andel > 0.0) {
                aarlig_sum = laane_andel;
                laane_andel = 0.0;
            }
            else if (laane_andel == 0.0) {
                aarlig_sum = 0.0;
            }
            else {
                console.error("Unexpected!");
            }

            let reell_sum = aarlig_sum * Math.pow((1 + input_prisstigning), year + dyear);

            console.log("Låneopptak (mill) i år", year + input_byggeoppstart, "er", (reell_sum / MLL).toFixed(4))
            cum = (cum + reell_sum) * (1.0 + rente);

            let part = reell_sum * Math.pow((1.0 + rente), input_byggetid - year);
            cum_projected += part;

            bygge_aar[year] = input_byggeoppstart + year;
            bygge_laanopptak[year] = reell_sum;
            bygge_kumulativt_laan[year] = cum;
            bygge_kumulativt_laan_proj[year] = part;   // vil bli feil dersom rente endres!
            bygge_rentefot[year] = rente;

        }

        return (cum);
    }

    function compute_sumloan3() {
        // Her er bomselskap seint og forholdet mellom stat og bomselskap må beregnes
        // Optimistisk scenario

        let cum = 0.0;
        let cum_projected = 0.0;

        let rente = input_laanerente1;

        let aarlig_total_sum = input_styringsramme / input_byggetid;
        let dyear = input_byggeoppstart - input_basisaar;
        let stat_andel = input_styringsramme - input_bompengelaan;
        let laane_andel = 0.0;
        let aarlig_sum = 0.0;
        console.log("Stat_andel vs aarlig_total_sum", stat_andel, aarlig_total_sum);

        for (let year = 0; year < input_byggetid; year++) {
            if (year >= input_laanerente_endring) {
                rente = input_laanerente2;
            }

            if (aarlig_total_sum < stat_andel) {
                aarlig_sum = 0.0;
                stat_andel = stat_andel - aarlig_total_sum;
            }
            else if (aarlig_total_sum > stat_andel && stat_andel > 0.0) {
                aarlig_sum = aarlig_total_sum - stat_andel;
                stat_andel = 0.0;
            }
            else if (stat_andel == 0.0) {
                aarlig_sum = aarlig_total_sum;
            }
            else {
                console.error("Unexpected!");
            }

            let reell_sum = aarlig_sum * Math.pow((1 + input_prisstigning), year + dyear);

            console.log("Låneopptak (mill) i år", year + input_byggeoppstart, "er", (reell_sum / MLL).toFixed(4))
            cum = (cum + reell_sum) * (1.0 + rente);

            let part = reell_sum * Math.pow((1.0 + rente), input_byggetid - year);
            cum_projected += part;

            bygge_aar[year] = input_byggeoppstart + year;
            bygge_laanopptak[year] = reell_sum;
            bygge_kumulativt_laan[year] = cum;
            bygge_kumulativt_laan_proj[year] = part;  // vil bli feil dersom rente endres!
            bygge_rentefot[year] = rente;

        }

        return (cum);
    }


    function yearly_streams(toll, mode = 0) {

        let cumincome = [];
        let cumrest = [];

        let rest = result_kumulativt_laan;
        let previousrest = rest;

        // both toll and bomselskap will increase with moneygrowth factor
        let xtoll = toll;
        let xbomselskap = input_bomselskap;
        let xbomselskap_sum = 0.0;
        let rente = input_laanerente1;
        let aar_renteendring = input_laanerente_endring - input_byggetid;
        console.log("YYYYY", aar_renteendring, input_laanerente_endring, input_byggetid)

        for (let year = 0; year <= MAXYEARS; year++) {

            if (year >= aar_renteendring) {
                rente = input_laanerente2;
            }

            xtoll = toll * Math.pow((1.0 + input_prisstigning), year);
            xbomselskap = input_bomselskap * Math.pow((1.0 + input_prisstigning), year);
            xbomselskap_sum += xbomselskap;

            let income = 0;
            let trafikk = input_aadt_oppstart;
            if (year > 0) {
                trafikk = input_aadt_oppstart * Math.pow((1 + input_trafikkvekst), (year))  // year - 1 ?
                income = 365 * trafikk * xtoll - xbomselskap;
                rest = (rest - income) * (1.0 + rente)
            }
            if (mode == 1) {
                result_bomsatser[year] = xtoll;
                result_bominntekt[year] = income;
                result_restlaan[year] = rest;
                result_tilbomselskap[year] = xbomselskap;
                result_rentefot[year] = rente;
                result_aadt[year] = trafikk;
                result_tilbomselskap_sum = xbomselskap_sum;
            }

            if (previousrest > 0.0 && rest <= 0.0) {
                return (year);
            }
            previousrest = rest;
        }

        return (-1);

    }


    function bycar_type(toll) {
        let v = input_elbil_andel;
        let e = input_elbil_rabattpris;
        let u = input_tungandel;
        let t = input_tungmult;

        // person car vs heavy
        let x = toll / (1 - u - v + u * v + v * e - v * e * u + u * t)

        console.log("Person vs Heavy", x, x * t)

        if (x > toll && t > 1) {
            x = NaN
            document.getElementById("umulig").innerHTML = "Umulig regnestykke, juster elbil fraksjon og/eller rabatt!";
        }
        else {
            document.getElementById("umulig").innerHTML = "";

        }

        let lettfossil = x
        let lettelbil = x * e
        let tung = x * t

        document.result.propfossil.value = lettfossil.toFixed(1)
        // document.result.propelbil.value = lettelbil.toFixed(1)
        document.result.proptung.value = tung.toFixed(1)

    }

    function main() {

        iterate_toll_value();
        proposed_toll = result_initiell_avg_bomsats;

        var emojis = ["&#128516;", "&#128528;", "&#128577;", "&#128555;", "&#128545; &#129322",
            "&#129324;&#128128;"];


        emoj = emojis[0]
        if (proposed_toll > 10) emoj = emojis[1];
        if (proposed_toll > 50) emoj = emojis[2];
        if (proposed_toll > 100) emoj = emojis[3];
        if (proposed_toll > 200) emoj = emojis[4];
        if (proposed_toll > 500) emoj = emojis[5];

        document.getElementById("emoji").innerHTML = emoj;

        var fixed = 0
        if (proposed_toll < 50) {
            fixed = 1;
        }
        document.result.proposed.value = proposed_toll.toFixed(fixed);
        document.result.proposed_end.value = result_bomsatser[input_nedbetalingstid - 1].toFixed(fixed);

        let deltaaar = input_byggetid + (input_byggeoppstart - input_basisaar);
        console.log("Deltaår:", deltaaar);
        let diskontert = proposed_toll / Math.pow((1.0 + input_prisstigning), deltaaar);
        document.result.proposed_start_disk.value = diskontert.toFixed(fixed);
        document.result.result_kumulativt_laan.value = (result_kumulativt_laan / MRD).toFixed(3);
        let sum_inkl = ((result_kumulativt_laan + input_forhaandsinnkrevet + result_tilbomselskap_sum) / MRD).toFixed(3);
        document.result.result_kumulativt_laan_all.value = sum_inkl;

        bycar_type(diskontert);

        reset_tabell();
        for (let i = 0; i < input_byggetid; i++) {
            let aar = bygge_aar[i];
            let rente = (bygge_rentefot[i] * 100);
            let opptaklaan = (bygge_laanopptak[i] / MRD).toFixed(4);
            let cumlaan = (bygge_kumulativt_laan[i] / MRD).toFixed(4);
            let cumlaan_proj = (bygge_kumulativt_laan_proj[i] / MRD).toFixed(4);
            bygge_tabell(aar, rente, opptaklaan, cumlaan);

        }

        for (let i = 0; i <= input_nedbetalingstid; i++) {
            let xrente = (result_rentefot[i] * 100);
            let sats = result_bomsatser[i].toFixed(2);
            let innt = (result_bominntekt[i] / MLL).toFixed(4);
            let tilbom = (result_tilbomselskap[i] / MLL).toFixed(4);
            let rest = (result_restlaan[i] / MLL).toFixed(4);
            let aar = i + input_byggeoppstart + input_byggetid;
            let trafikk = Math.round(result_aadt[i]);
            result_tabell(xrente, aar, sats, trafikk, tilbom, innt, rest);

        }


    }

    function avg_value(arr) {
        let nlen = arr.length;
        let sum = 0.0;
        for (let i = 0; i < nlen; i++) {
            sum += arr[i]
        }
        return (sum / nlen);
    }

    function reset_tabell() {
        let table = document.getElementById("restabell");
        var rowCount = table.rows.length;
        for (var x = rowCount - 1; x > 0; x--) {
            table.deleteRow(x);
        }

        let btable = document.getElementById("byggtabell");
        var rowCount = btable.rows.length;
        for (var x = rowCount - 1; x > 0; x--) {
            btable.deleteRow(x);
        }
    }
    function result_tabell(rente, aar, sats, trafikk, tilbom, innt, rest) {
        let table = document.getElementById("restabell");

        var row = table.insertRow(-1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        var cell7 = row.insertCell(6);
        cell1.innerHTML = aar;
        cell2.innerHTML = rente;
        cell3.innerHTML = sats;
        cell4.innerHTML = trafikk;
        cell5.innerHTML = tilbom;
        cell6.innerHTML = innt;
        cell7.innerHTML = rest;
    }

    function bygge_tabell(aar, a, b, c) {
        let table = document.getElementById("byggtabell");

        var row = table.insertRow(-1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        cell1.innerHTML = aar;
        cell2.innerHTML = a;
        cell3.innerHTML = b;
        cell4.innerHTML = c;
    }




    function resetcase() {
        document.calc.byggeoppstart.value = null;
        document.calc.byggetid.value = null;
        document.calc.styringsramme.value = null;
        document.calc.kostnadsramme.value = null;
        document.calc.basisaar.value = null;
        document.calc.bompengelaan.value = null;
        document.calc.laaneprofil.value = 1;
        document.calc.forhaandsinnkrevet.value = null;
        document.calc.nedbetalingstid.value = null;
        document.calc.laanerente1.value = null;
        document.calc.laanerente2.value = null;
        document.calc.laanerente_endring.value = null;
        document.calc.prisstigning.value = null;
        document.calc.aadt_oppstart.value = null;
        document.calc.trafikkvekst.value = null;
        document.calc.bomselskap.value = null;
        document.calc.tungandel.value = null;
        document.calc.tungmult.value = null;
        document.calc.offisielt.value = "";
        reset_tabell();
    }

    function testcase() {
        document.calc.byggeoppstart.value = 2016;
        document.calc.byggetid.value = 5;
        document.calc.styringsramme.value = 10;
        document.calc.kostnadsramme.value = 12;
        document.calc.basisaar.value = 2013;
        document.calc.bompengelaan.value = 5;
        document.calc.laaneprofil.value = 1;
        document.calc.forhaandsinnkrevet.value = 0.0;
        document.calc.nedbetalingstid.value = 15;
        document.calc.laanerente1.value = 5;
        document.calc.laanerente2.value = 6;
        document.calc.laanerente_endring.value = 10;
        document.calc.prisstigning.value = 0;
        document.calc.aadt_oppstart.value = 20000
        document.calc.trafikkvekst.value = 1;
        document.calc.bomselskap.value = 5;
        document.calc.tungandel.value = 15;
        document.calc.tungmult.value = 3;
        document.calc.offisielt.value = "12?";
        reset_tabell();
    }

    function rogfast1() {
        document.calc.byggeoppstart.value = 2021;
        document.calc.byggetid.value = 10;
        document.calc.styringsramme.value = 20.6;
        document.calc.kostnadsramme.value = 24.8;
        document.calc.basisaar.value = 2020;
        document.calc.bompengelaan.value = 10.66;
        document.calc.laaneprofil.value = 4;
        document.calc.forhaandsinnkrevet.value = 1.7;
        document.calc.nedbetalingstid.value = 20;
        document.calc.laanerente1.value = 5.5;
        document.calc.laanerente2.value = 6.5;
        document.calc.laanerente_endring.value = 8;
        document.calc.prisstigning.value = 2;
        document.calc.aadt_oppstart.value = 5980;
        document.calc.trafikkvekst.value = 1.5;
        document.calc.bomselskap.value = 6;
        document.calc.tungandel.value = 12;
        document.calc.tungmult.value = 3;
        document.calc.offisielt.value = "409 (2020) kr, St.prop. 54 S 2020";

        document.bomaarlig.aar1.value = 0.0;
        document.bomaarlig.aar2.value = 8.323;  // 2022
        document.bomaarlig.aar3.value = 0.0;
        document.bomaarlig.aar4.value = 0.0;
        document.bomaarlig.aar5.value = 0.0;
        document.bomaarlig.aar6.value = 0.0;
        document.bomaarlig.aar7.value = 0.0;
        document.bomaarlig.aar8.value = 2.334;    // 2028  Sum 10.657 MRD
        document.bomaarlig.aar9.value = 0.0;
        document.bomaarlig.aar10.value = 0.0;
    }

    // https://www.regjeringen.no/contentassets/7cb4217acb094720905ba6c438cd3ab7/svv-vedlegg-1-leveranse-til-sd-endelig.pdf
    function hordfast1() {
        document.calc.byggetid.value = 7;
        document.calc.byggeoppstart.value = 2026;
        document.calc.styringsramme.value = 37.7;
        document.calc.kostnadsramme.value = 44.0;
        document.calc.basisaar.value = 2021;
        document.calc.bompengelaan.value = 13.4;
        document.calc.laaneprofil.value = 1;
        document.calc.forhaandsinnkrevet.value = 0;
        document.calc.nedbetalingstid.value = 20;
        document.calc.laanerente1.value = 5.5;
        document.calc.laanerente2.value = 6.5;
        document.calc.laanerente_endring.value = 10;
        document.calc.prisstigning.value = 2;
        document.calc.aadt_oppstart.value = 4500;
        document.calc.trafikkvekst.value = 1.0;
        document.calc.bomselskap.value = 15;
        document.calc.tungandel.value = 13;
        document.calc.tungmult.value = 3;
        document.calc.offisielt.value = "Noe spekulasjon";

    }


    // https://www.regjeringen.no/contentassets/72a5e7fc2d5048a0a4268aa2714301f5/no/pdfs/prp201020110103000dddpdfs.pdf
    function grime_vesleelva() {
        document.calc.byggetid.value = 2;
        document.calc.byggeoppstart.value = 2012;
        document.calc.styringsramme.value = 0.193;
        document.calc.kostnadsramme.value = 0.193;
        document.calc.basisaar.value = 2011;
        document.calc.bompengelaan.value = 0.101;
        document.calc.laaneprofil.value = 1;
        document.calc.forhaandsinnkrevet.value = 0;
        document.calc.nedbetalingstid.value = 15;
        document.calc.laanerente1.value = 8;
        document.calc.laanerente2.value = 8;
        document.calc.laanerente_endring.value = 10;
        document.calc.prisstigning.value = 2;
        document.calc.aadt_oppstart.value = 1500;
        document.calc.trafikkvekst.value = 1.1;
        document.calc.bomselskap.value = 3;
        document.calc.tungandel.value = 15;
        document.calc.tungmult.value = 2;
        document.calc.offisielt.value = "24.5 kr ved åpning, St.prop. 103 S 2010";
    }

    function kilden_presterudskrysset() {
        document.calc.byggetid.value = 2;
        document.calc.byggeoppstart.value = 2018;
        document.calc.styringsramme.value = 0.226;
        document.calc.kostnadsramme.value = 0.226;
        document.calc.basisaar.value = 2017;
        document.calc.bompengelaan.value = 0.194;
        document.calc.laaneprofil.value = 1;
        document.calc.forhaandsinnkrevet.value = 0;
        document.calc.nedbetalingstid.value = 4;
        document.calc.laanerente1.value = 5.5;
        document.calc.laanerente2.value = 5.5;
        document.calc.laanerente_endring.value = 10;
        document.calc.prisstigning.value = 2.5;
        document.calc.aadt_oppstart.value = 10800;
        document.calc.trafikkvekst.value = 1.7;
        document.calc.bomselskap.value = 3;
        document.calc.tungandel.value = 7;
        document.calc.tungmult.value = 2;
        document.calc.offisielt.value = "13.5 kr, St.prop. 103 S";
    }

    function foenhus_bagn() {
        document.calc.byggetid.value = 2;
        document.calc.byggeoppstart.value = 2012;
        document.calc.styringsramme.value = 0.420;
        document.calc.kostnadsramme.value = 0.440;
        document.calc.basisaar.value = 2012;
        document.calc.bompengelaan.value = 0.220;
        document.calc.laaneprofil.value = 2;
        document.calc.forhaandsinnkrevet.value = 0;
        document.calc.nedbetalingstid.value = 15;
        document.calc.laanerente1.value = 6.5;
        document.calc.laanerente2.value = 6.5;
        document.calc.laanerente_endring.value = 10;
        document.calc.prisstigning.value = 2.5;
        document.calc.aadt_oppstart.value = 2200;
        document.calc.trafikkvekst.value = 1.0;
        document.calc.bomselskap.value = 3;
        document.calc.tungandel.value = 13;
        document.calc.tungmult.value = 2;
        document.calc.offisielt.value = "30 kr, St.prop.";
    }

</script>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <style>
        body {
            font-family: 'Courier New', monospace;
        }

        input[type="text"] {
            font-size: 14px;
            font-family: 'Courier New', monospace;
        }

        #knapp {
            border-collapse: collapse;
            width: 95%;
        }

        #knapp td,
        #knapp th {
            border: 0px solid #ddd;
            padding: 8px;
        }

        /* #knapp tr:nth-child(even) {
            background-color: #f2f2f2;
        } */

        #bom {
            font-family: 'Courier New', monospace;
            border-collapse: collapse;
            width: 95%;
        }

        #bom input {
            border: 1px solid #ddd;
            padding: 6px;
        }

        #bom td,
        #bom th {
            border: 1px solid #ddd;
            padding: 6px;
        }

        #bom tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #bom tr:hover {
            background-color: #ddd;
        }

        #bom th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #5b5b5c;
            color: white;
        }



        #bomaar {
            font-family: 'Courier New', monospace;
            border-collapse: collapse;
            width: 95%;
        }

        #bomaar input {
            border: 1px solid #ddd;
            padding: 6px;
        }

        #bomaar td,
        #bomaar th {
            border: 1px solid #ddd;
            padding: 6px;
        }

        #bomaar tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #bomaar tr:hover {
            background-color: #ddd;
        }

        #bomaar th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #5b5b5c;
            color: white;
        }






        #res {
            border-collapse: collapse;
            width: 95%;
        }

        #res td,
        #res th {
            border: 1px solid #ddd;
            padding: 6px;
        }


        #res tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #res tr:nth-child(1) {
            background-color: #c58080;
        }


        #res input {
            border: 1px solid #ddd;
            padding: 6px;
        }

        #res th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #682288;
            color: white;
        }

        #restabell {
            border-collapse: collapse;
            width: 95%;
        }

        #restabell td,
        #restabell th {
            border: 1px solid #ddd;
            padding: 6px;
        }


        #restabell tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #restabell tr:nth-child(1) {
            background-color: #c58080;
        }


        #restabell input {
            border: 1px solid #ddd;
            padding: 6px;
        }

        #restabell th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #682288;
            color: white;
        }

        #byggtabell {
            border-collapse: collapse;
            width: 95%;
        }

        #byggtabell td,
        #byggtabell th {
            border: 1px solid #ddd;
            padding: 6px;
        }


        #byggtabell tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #byggtabell tr:nth-child(1) {
            background-color: #c58080;
        }


        #byggtabell input {
            border: 1px solid #ddd;
            padding: 6px;
        }

        #byggtabell th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #682288;
            color: white;
        }

        .button {
            background-color: #616909;
            font-family: 'Courier New', monospace;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 22px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 6px;
        }

        .button3 {
            background-color: #A44400;
        }

        .button4 {
            background-color: #e597f0;
            padding: 10px 32px;
            font-size: 13px;
            color: black;
            border-radius: 6px;
        }

        div.a {
            text-align: left;
            font-size: 12px;
            font-family: 'Helvetica';
            text-indent: 70px;
        }

        div.b {
            font-size: 16px;
            font-family: 'Helvetica';
            color: #A44400;

            text-indent: 70px;
        }

        ul.a {
            text-align: left;
            font-size: 14px;
            font-family: 'Helvetica';
            margin-left: 40px;
            margin-right: 40px;
        }

        /* Red */
    </style>
</head>

<body>

    <p>


        <center>
            <div class="b">
                <h3>Instruksjon:
                    Trykk på en av de lilla knappene under for eksempelinnfylling. Trykk så
                    på <b>Beregn</b> knappen lengre nede. Juster tall og se effekt. </h3>
            </div>
            <br>
            <form name=case method=POST>
                <table id="knapp">

                    <tr>
                        <td align=center><input type=button class="button button4" onClick='testcase()' value=Generell>
                        </td>
                        <td align=center><input type=button class="button button4" onClick='rogfast1()' value=Rogfast>
                        </td>
                        <td align=center><input type=button class="button button4" onClick='hordfast1()' value=Hordfast>
                        </td>
                    </tr>
                    <tr>
                        <td align=center><input type=button class="button button4" onClick='grime_vesleelva()'
                                value=Grime-Vesleelva>
                        <td align=center><input type=button class="button button4" onClick='kilden_presterudskrysset()'
                                value=Kilden-Presterudkrysset>
                        </td>
                        <td align=center><input type=button class="button button4" onClick='foenhus_bagn()'
                                value=Fønhus-Bagn>
                        </td>

                    </tr>
                </table>
                <h3>Beskrivelse</h3>
                <ul class="a">
                    <li>Generell: Enkelt test eksempel</li>
                    <li>E39 Rogfast: Fra <A
                            HREF=https://www.regjeringen.no/contentassets/8e5b283f2fd34f7b8559705ad9d2502b/nn-no/pdfs/prp202020210054000dddpdfs.pdf>stortingsproposisjon
                            2020-2021</A>
                        Bompengesummesummen er her begrenset til det som skal innkreves etter åpning. Det er i tillegg
                        forhåndsinnkreving i perioden 2013-2030 på fergen (ca 1,7 milliarder i sum). Tilsammen blir
                        bompenger betalt i 37 år! "Med desse føresetnadene er det rekna at brutto
                        bompengeinntekter vert om lag 19 720 mill. 2020-kroner inkludert inntektene frå
                        førehandsinnkrevjinga som starta i 2013."</li>
                    <li>E39 Hordfast: Kostnadstall og bompengenandel fra <A
                            HREF=https://www.regjeringen.no/contentassets/7cb4217acb094720905ba6c438cd3ab7/svv-vedlegg-1-leveranse-til-sd-endelig.pdf>
                            innspill til NTP høsten 2020.</A>
                        Hvordan og hvorfor ÅDT skal øke fra dagens 3100 til 5700 i 2030 selv
                        med så høye bompenger er ikke lett å forstå!</li>
                    <li>FV. 34 Grime-Vesleelva for validering: Fra <A
                            HREF=https://www.regjeringen.no/contentassets/72a5e7fc2d5048a0a4268aa2714301f5/no/pdfs/prp201020110103000dddpdfs.pdf>prop
                            103 S (2010-2011)</A></li>
                    <li>FV. 311 Kilden-Presterudkrysset for validering: Fra <A
                            HREF=https://www.regjeringen.no/contentassets/0b1c67e1808d45d29e474abd16125416/no/pdfs/prp201720180103000dddpdfs.pdf>prop
                            103 S (2017-2018)</A></li>
                    <li>E16 Fønhus-Bagn for validering: Fra <A
                            HREF=https://www.regjeringen.no/contentassets/262884fcb4ac4a21a69b1b809bc3dae4/no/pdfs/prp201120120101000dddpdfs.pdf>prop.
                            101 S (2011-2012). "</A> Fra info 2021: "Det vil koste 34 kroner per passering for lette
                        kjøretøy og det dobbelte for tunge kjøretøy. Med gyldig AutoPASS-avtale får du ti prosent rabatt
                        og betaler
                        ikke for mer enn 40 passeringer per måned gjennom bomstasjonen i Sør-Aurdal.
                    </li>
                </ul>
                <hr>

            </form>
            <br>
            <form name=calc method=POST>
                <table id="bom">
                    <tr>
                        <th width=70%>Beskrivelse</th>
                        <th width=30%>Inngangsdata</th>
                    </tr>
                    <tr>
                        <td>Oppstart bygging (år, for eks. 2021)</td>
                        <td><input type=text name=byggeoppstart size=10></td>
                    </tr>
                    <tr>
                        <td>Byggetid (hele år)</td>
                        <td><input type=text name=byggetid size=10></td>
                    </tr>
                    <tr>
                        <td>Total kostnad styringsramme (MRD kr)</td>
                        <td><input type=text name=styringsramme size=10></td>
                    </tr>
                    <tr>
                        <td>Total kostnad kostnadsramme (MRD kr)</td>
                        <td><input type=text name=kostnadsramme size=10></td>
                    </tr>
                    <tr>
                        <td>Basisår for styringsramme</td>
                        <td><input type=text name=basisaar size=10></td>
                    </tr>
                    <tr>
                        <td>Bompengelån for etterskuddsinnkreving (MRD kr)</td>
                        <td><input type=text name=bompengelaan size=10></td>
                    </tr>
                    <tr>
                        <td>Bompengelån, velg låneprofil</td>
                        <td><select id="laaneprofil">
                                <option value=0>(test)</option>
                                <option value=1 selected>Jevn fordeling</option>
                                <option value=2>Bompengeselskap før offentlige</option>
                                <option value=3>Bompengeselskap etter offentlige</option>
                                <option value=4>Profil per år</option>
                            </select></td>
                    </tr>
                    <tr>
                        <td>Forhåndsinnkreving (sum, for info) (MRD kr)</td>
                        <td><input type=text name=forhaandsinnkrevet size=10></td>
                    </tr>
                    <tr>
                        <td>Nedbetalingstid (år)</td>
                        <td><input type=text name=nedbetalingstid size=10></td>
                    </tr>
                    <tr>
                        <td>Lånerente i % (første X år)</td>
                        <td><input type=text name=laanerente1 size=10></td>
                    </tr>
                    <tr>
                        <td>Lånerente i % (etter X år)</td>
                        <td><input type=text name=laanerente2 size=10></td>
                    </tr>
                    <tr>
                        <td>Antall år (X) for lånerente</td>
                        <td><input type=text name=laanerente_endring size=10></td>
                    </tr>
                    <tr>
                        <td>Generell prisstigning i %</td>
                        <td><input type=text name=prisstigning size=10></td>
                    </tr>
                    <tr>
                        <td>ÅDT oppstart</td>
                        <td><input type=text name=aadt_oppstart size=10></td>
                    </tr>
                    <tr>
                        <td>Forventet trafikkvekst per år %</td>
                        <td><input type=text name=trafikkvekst size=10></td>
                    </tr>
                    <tr>
                        <td>Årlig betaling til bomselskap (mill. kr)</td>
                        <td><input type=text name=bomselskap size=10></td>
                    </tr>
                    <tr>
                        <td>Andel tunge kjøretøy %</td>
                        <td><input type=text name=tungandel size=10></td>
                    </tr>
                    <tr>
                        <td>Bompengefaktor (multiplikator) tunge kjøretøy</td>
                        <td><input type=text name=tungmult size=10></td>
                    </tr>
                    <tr>
                        <td style="color: #74178b;" ;">Gjennomsnitt bompenger offisielt fra vedtak eller kjent svar
                        </td>
                        <td><input type=text name=offisielt size=38 style="background-color:#dd92f0;" readonly></td>
                    </tr>
                </table>
            </form>
            <br>
            <br>
            <form name=bomaarlig method=POST>
                Denne blir kun brukt dersom låneprofil er "Profil per år":
                <br>
                <table id="bomaar">
                    <tr>
                        <th style="width: 10%; text-align:center;">År 1</th>
                        <th style="width: 10%; text-align:center;">År 2</th>
                        <th style="width: 10%; text-align:center;">År 3</th>
                        <th style="width: 10%; text-align:center;">År 4</th>
                        <th style="width: 10%; text-align:center;">År 5</th>
                        <th style="width: 10%; text-align:center;">År 6</th>
                        <th style="width: 10%; text-align:center;">År 7</th>
                        <th style="width: 10%; text-align:center;">År 8</th>
                        <th style="width: 10%; text-align:center;">År 9</th>
                        <th style="width: 10%; text-align:center;">År 10</th>
                    </tr>
                    <td><input type=text name=aar1 size=8"></td>
                    <td><input type=text name=aar2 size=8"></td>
                    <td><input type=text name=aar3 size=8"></td>
                    <td><input type=text name=aar4 size=8"></td>
                    <td><input type=text name=aar5 size=8"></td>
                    <td><input type=text name=aar6 size=8"></td>
                    <td><input type=text name=aar7 size=8"></td>
                    <td><input type=text name=aar8 size=8"></td>
                    <td><input type=text name=aar9 size=8"></td>
                    <td><input type=text name=aar10 size=8"></td>
                </table>
            </form>
            <br>
            <br>
            <br>
            <form name=knapp method=POST>
                <table id=" knapp">

                    <tr>
                        <td align=center width=50%><input type=button class="button" onClick='main()' value="Beregn"
                                <Input>
                        </td>
                        <td align=center width=50%><input type=button class="button button3" onClick='resetcase()'
                                value="Reset" <Input>
                        </td>
                    </tr>
                </table>
            </form>
            <br>
            <br>
            <form name=result method=POST>
                <span style="font-size: 250%" id="emoji"></span>
                <br>
                <span style="font-size: 120%" id="umulig"></span>
                <table id="res">
                    <tr>
                        <th width=70%>Beregnede verdier</th>
                        <th width=30%>Verdi</th>
                    </tr>
                    <tr style="background-color:#d897fd; font-size: 20px;font-weight: 800;">
                        <td>Estimert gjennomsnitt bomtakst, diskontert til basisår</td>
                        <td><input type=text name=proposed_start_disk size=10 readonly
                                style="background-color:#fbe5ba; font-size: 20px; font-weight: 800;"> kr</td>
                    </tr>
                    <tr>
                        <td>Estimert gjennomsnitt bomtakst ved oppstart bompengeperiode</td>
                        <td><input type=text name=proposed size=10 readonly> kr</td>
                    </tr>
                    <tr>
                        <td>Estimert gjennomsnitt bomtakst ved slutt bompengeperiode</td>
                        <td><input type=text name=proposed_end size=10 readonly> kr</td>
                    </tr>
                    <tr>
                        <td>Bompenger lett bil (diskontert)</td>
                        <td><input type=text name=propfossil size=10 readonly> kr</td>

                    </tr>
                    <tr>
                        <td>Bompenger tunge kjøretøy (diskontert)</td>
                        <td><input type=text name=proptung size=10 readonly> kr</td>
                    </tr>
                    <tr>
                        <td>Kumulativ kostnad bompengelån med renter</td>
                        <td><input type=text name=result_kumulativt_laan size=10 readonly> MRD kr</td>
                    </tr>
                    <tr>
                        <td>Kumulativ kostnad bompengelån med renter + forhåndsinnkrevet + bomselskap</td>
                        <td><input type=text name=result_kumulativt_laan_all size=10 readonly> MRD kr</td>
                    </tr>
                </table>
            </form>
            <br>
            <br>
            <br>
            <form name=tabell>
                <table id=byggtabell>
                    <tr>
                        <th width=20%>År</th>
                        <th width=20%>Rentefot</th>
                        <th width=20%>Opptak lån 1/1</th>
                        <th width=20%>Kumulativt lån 31/12</th>
                    </tr>

                </table>
            </form>
            <br>
            <form name=tabell>
                <table id=restabell>
                    <tr>
                        <th width=10%>År</th>
                        <th width=10%>Rentefot</th>
                        <th width=15%>Bomsats</th>
                        <th width=10%>Trafikk ÅDT</th>
                        <th width=20%>Utgift bomselskap (mill. NOK)</th>
                        <th width=20%>Inntekt (mill. NOK)</th>
                        <th width=20%>Rest (mill. NOK)</th>
                    </tr>

                </table>
            </form>
            <br>

        </center>
    </p>
</body>

</html>
